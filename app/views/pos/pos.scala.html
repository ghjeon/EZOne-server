@import scala.concurrent.ExecutionContext.Implicits.global

@views.html.common.header("product")
<link rel="stylesheet" href="/assets/stylesheets/typeaheadjs.css" />
<style>
#scrollable-dropdown-menu .tt-dropdown-menu {
max-height: 150px;
overflow-y: auto;
}
</style>
<script src="/assets/javascripts/typeahead.js" type="text/javascript"></script>
<script type="text/javascript">

	var i = 1;

	
	
    var products = new Bloodhound({
    datumTokenizer: function (datum) {
        return Bloodhound.tokenizers.whitespace(datum.value);
    },
    queryTokenizer: Bloodhound.tokenizers.whitespace,
    remote: {
        url: '/Product/findAll/%QUERY',
        filter: function (products) {
            return $.map(JSON.parse(products.data), function (product) {
                return {
                	srl:product.product_srl,
                	code:product.product_code,
					name:product.product_name,
					price:product.product_sale_price,
                    value: product.product_code + "&nbsp;&nbsp" + product.product_name + "&nbsp;&nbsp;" + product.product_sale_price
                };
            });
        }
    }
});



    $(document).ready(function() {
    $("#purchaseList").on('keyup', function(sender) {
		var srl = sender.target.id.replace("prdCount_", "");
		var count = parseInt($(sender.target).val())
		if(count != NaN)
		{
			if(count == 0)
			{
				
			}
			else
			{
				var totalPrice = parseInt($("#prdOrigPrice_" + srl).val()) * parseInt($(sender.target).val());
				$("#prdPrice_" + srl).text(totalPrice);
			}
				
		}	
	});
    
    products.initialize();
    $('.typeahead').typeahead(null, {displayKey: 'value',
    source: products.ttAdapter()
    }).bind('typeahead:selected', function(obj, selected, name) {
    	$("#purchaseList").append("<tr id='" + selected.srl + "'>" + "<td>" +  i + "</td>" + "<td>" + selected.code + "</td>" + "<td>" + selected.name + "</td>"  + "<td class='prdCountWrap'>" + "<input type='hidden' id='prdOrigPrice_" + selected.srl  + "' value='" + selected.price + "' /><input type='text' value='1' class='prdCount' id='prdCount_" + selected.srl + "'" + ">"  + "</td>" + "<td class='prdPrice' id='prdPrice_" + selected.srl + "'>" + selected.price + "</td>"  + "</tr>");
    	$(".typeahead").val("");
    	$("#prdCount_" + selected.srl).focus();
    	i++;
    });
    });
</script>

<div class="container" role="main">
    <div class="page-header">
        <h1>판매 관리</h1>

    </div>
    <div class="row">
        <div class="col-md-12" style="margin-bottom:3%">
            <div id="scrollable-dropdown-menu">
                <input class="typeahead" type="text" placeholder="상품 검색">
           </div>
        </div>
        <div class="col-md-6">
            <table id="purchaseListHead" class="table">
                <tr id="header">
                    <th>No.</th>
                    <th>상품명</th>
                    <th>수량</th>
                    <th>금액</th>
                </tr>
            </table>
            <table id="purchaseList" class="table">

            </table>
        </div>
        <div class="col-md-6" style="text-align:center">
            <div class="col-md-12">
                <table class="table" id="funcPanel">
                    <tr>
                        <td>A</td>
                        <td>B</td>
                        <td>C</td>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td>B</td>
                        <td>C</td>
                    </tr>
                    <tr>
                        <td>A</td>
                        <td>B</td>
                        <td>C</td>
                    </tr>
                </table>
            </div>
            <div class="col-md-12">
                <table class="table" id="numPanel">
                    <tr>
                        <td>1</td>
                        <td>2</td>
                        <td>3</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>5</td>
                        <td>6</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>8</td>
                        <td>9</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>0</td>
                        <td>&nbsp;</td>
                    </tr>
                </table>
            </div>
            <div class="col-md-12">
                <table class="table" id="payPanel">

                </table>
            </div>
        </div>
    </div>


@views.html.common.footer()